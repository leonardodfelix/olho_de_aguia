<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Olho de Águia — ODS 3: Saúde e Bem-Estar</title>
  <meta name="description"
    content="Trabalho do 6º ano B sobre ODS 3 com simulador de visão: miopia, astigmatismo, daltonismo e catarata." />
  <style>
    :root {
      --bg: #0d1016;
      --card: #161a22;
      --text: #e8edf2;
      --muted: #a6b0bf;
      --border: #222838;
      --success: #46d27c;
      --brand-1: #f2d074;
      --brand-2: #d9b24c;
      --brand-3: #b9912f;
      --focus: #3b77ff;
    }

    * {
      box-sizing: border-box;
    }

    html,
    body {
      margin: 0;
      padding: 0;
      background: radial-gradient(1200px 800px at 20% 0%, #121622, #0b0e15) fixed,
        var(--bg);
      color: var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial,
        sans-serif;
      line-height: 1.5;
    }

    a {
      color: inherit;
    }

    .container {
      max-width: 1100px;
      margin: 0 auto;
      padding: 16px 16px 64px;
    }

    /* ============== Header/Brand ============== */

    header.site-header {
      padding: 18px 0 12px;
    }

    .brand {
      display: grid;
      gap: 8px;
      justify-items: start;
    }

    .logo {
      display: inline-grid;
      gap: 6px;
    }

    .logo-svg {
      width: clamp(200px, 36vw, 340px);
      height: auto;
      display: block;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 10px;
      border: 1px solid var(--border);
      border-radius: 999px;
      background: #0f1423;
      color: var(--text);
      font-weight: 600;
      font-size: 0.86rem;
    }

    .badge .dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--success);
    }

    .subtitle {
      color: var(--muted);
      margin-top: 8px;
      font-size: 0.98rem;
    }

    /* ============== Layout Principal ============== */

    .layout {
      display: grid;
      gap: 16px;
    }

    @media (min-width: 900px) {
      .layout {
        grid-template-columns: 380px 1fr;
        align-items: start;
      }
    }

    .card {
      background: linear-gradient(180deg, #141926, #121625);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 14px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.22),
        inset 0 1px 0 rgba(255, 255, 255, 0.03);
    }

    .stack {
      display: grid;
      gap: 12px;
    }

    label {
      font-weight: 600;
      font-size: 0.95rem;
    }

    .row {
      display: grid;
      gap: 8px;
    }

    .row-inline {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 8px;
      align-items: center;
    }

    .control-2 {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 8px;
      align-items: center;
    }

    select,
    input[type="range"],
    input[type="file"],
    button {
      width: 100%;
      background: #0e1320;
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 10px 12px;
      outline: none;
      transition: border 0.2s ease, box-shadow 0.2s ease, transform 0.05s;
    }

    select:focus,
    input[type="range"]:focus,
    input[type="file"]:focus,
    button:focus {
      border-color: var(--focus);
      box-shadow: 0 0 0 3px rgba(59, 119, 255, 0.15);
    }

    input[type="range"] {
      -webkit-appearance: none;
      height: 36px;
      padding: 0 10px;
    }

    input[type="range"]::-webkit-slider-runnable-track {
      height: 6px;
      background: linear-gradient(90deg, #1b2132, #1a2130);
      border-radius: 8px;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 22px;
      height: 22px;
      margin-top: -8px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #9bd2ff, #59b5ff);
      border: 1px solid #2a5e9c;
      box-shadow: 0 3px 10px rgba(89, 181, 255, 0.25);
    }

    input[type="range"]::-moz-range-track {
      height: 6px;
      background: linear-gradient(90deg, #1b2132, #1a2130);
      border-radius: 8px;
    }

    input[type="range"]::-moz-range-thumb {
      width: 22px;
      height: 22px;
      border: none;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #9bd2ff, #59b5ff);
      box-shadow: 0 3px 10px rgba(89, 181, 255, 0.25);
    }

    .hint {
      color: var(--muted);
      font-size: 0.85rem;
    }

    /* ============== Viewer ============== */

    .viewer {
      display: grid;
      gap: 10px;
    }

    .stage {
      position: relative;
      background: #0b0f19;
      border: 1px solid var(--border);
      border-radius: 14px;
      overflow: hidden;
      aspect-ratio: 16 / 10;
      min-height: 220px;
    }

    .stage .img-wrap,
    .stage canvas {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .img-wrap {
      display: grid;
      place-items: center;
    }

    .img-wrap img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      filter: none;
      transition: filter 0.12s linear;
    }

    .toolbar {
      display: grid;
      grid-template-columns: 1fr;
      gap: 8px;
    }

    @media (min-width: 520px) {
      .toolbar {
        grid-template-columns: 1fr 1fr;
      }
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 10px 12px;
      background: #101527;
      border: 1px solid var(--border);
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
    }

    .btn.secondary {
      background: #0f1423;
    }

    .footer-note {
      margin-top: 4px;
      color: var(--muted);
      font-size: 0.85rem;
      text-align: center;
    }

    /* ============== Conteúdo educativo ============== */

    .edu h2 {
      margin: 0 0 8px 0;
      font-size: 1.2rem;
    }

    .edu p,
    .edu li {
      color: #d7dfeb;
    }

    .ods-pill {
      background: #0f1a12;
      border-color: #1f3b29;
    }

    .ods-pill .dot {
      background: var(--success);
    }

    .group-card ul {
      margin: 0;
      padding-left: 18px;
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- Header -->
    <header class="site-header">
      <div class="brand" aria-label="Olho de Águia">
        <div class="logo">
          <!-- Logo nova: olhos + nome original -->
          <svg class="logo-svg" viewBox="0 0 640 200" xmlns="http://www.w3.org/2000/svg" role="img"
            aria-labelledby="logoTitle">
            <title id="logoTitle">Olho de Águia</title>
            <defs>
              <linearGradient id="gold" x1="0" x2="0" y1="0" y2="1">
                <stop offset="0%" stop-color="var(--brand-1)" />
                <stop offset="55%" stop-color="var(--brand-2)" />
                <stop offset="100%" stop-color="var(--brand-3)" />
              </linearGradient>
            </defs>

            <!-- Olhos estilizados -->
            <g fill="#0b0b0b" stroke="#0b0b0b" stroke-width="2">
              <!-- Esquerdo -->
              <path d="M170 55c28-24 66-22 92 2-15 0-27 6-35 14 16-3 30 1 40 8-28 2-50 16-81 5-10-4-16-10-16-29Z" />
              <!-- Direito (espelho) -->
              <g transform="translate(470,67) scale(-1,1) translate(-170,-12)">
                <path d="M170 55c28-24 66-22 92 2-15 0-27 6-35 14 16-3 30 1 40 8-28 2-50 16-81 5-10-4-16-10-16-29Z" />
              </g>
            </g>

            <!-- Título “Olho de Águia” -->
            <g font-family="Georgia, 'Times New Roman', serif" text-anchor="middle" fill="url(#gold)">
              <text x="320" y="120" font-size="44" font-weight="800">
                OLHO DE ÁGUIA
              </text>
            </g>
          </svg>

          <span class="badge ods-pill" title="ODS 3: Saúde e Bem-Estar">
            <span class="dot"></span>
            ODS 3: Saúde e Bem-Estar
          </span>
        </div>

        <div class="subtitle">
          Trabalho do 6º ano B: entendendo a visão e a importância do cuidado
          com os olhos.
        </div>
      </div>
    </header>

    <!-- Layout principal: coluna de controles + coluna livre (texto/explicações) -->
    <main class="layout">
      <!-- Coluna esquerda -->
      <section class="card stack" aria-label="Controles do simulador">
        <div class="row">
          <label for="disease">Condição</label>
          <div class="control-2">
            <select id="disease" aria-label="Selecione a condição">
              <option value="miopia" selected>Miopia</option>
              <option value="astigmatismo">Astigmatismo</option>
              <option value="daltonismo">Daltonismo</option>
              <option value="catarata">Catarata</option>
            </select>
            <button id="resetBtn" class="btn secondary" type="button">
              Resetar
            </button>
          </div>
        </div>

        <div class="row" id="intensityRow">
          <label for="intensityLabel" id="intensityTitle">Intensidade</label>
          <div class="row-inline">
            <input id="intensity" type="range" min="0" max="100" value="40" step="1" aria-labelledby="intensityTitle" />
            <span class="hint" id="intensityLabel">40%</span>
          </div>
          <div class="hint" id="intensityHelp">
            Ajuste conforme a condição selecionada.
          </div>
        </div>

        <div class="row" id="typeRow" style="display: none">
          <label for="typeSelect" id="typeLabel">Tipo</label>
          <select id="typeSelect" aria-labelledby="typeLabel">
            <option value="protanopia">Protanopia</option>
            <option value="deuteranopia" selected>Deuteranopia</option>
            <option value="tritanopia">Tritanopia</option>
          </select>
          <div class="hint">Selecione o tipo de daltonismo.</div>
        </div>

        <div class="row">
          <label for="upload">Imagem</label>
          <input id="upload" type="file" accept="image/*" aria-label="Enviar imagem" />
          <div class="hint">
            Envie uma imagem para ver os efeitos. Por padrão, usamos uma
            imagem demonstrativa.
          </div>
        </div>

        <!-- Viewer -->
        <div class="viewer" aria-label="Simulador">
          <div class="stage" id="stage">
            <div class="img-wrap">
              <img id="baseImg" alt="Imagem demonstrativa para simulação visual"
                src="https://images.unsplash.com/photo-1501785888041-af3ef285b470?q=80&w=1600&auto=format&fit=crop"
                crossorigin="anonymous" />
            </div>
            <canvas id="canvas"></canvas>
          </div>

          <div class="toolbar">
            <button id="downloadBtn" class="btn" type="button">
              Baixar resultado
            </button>
            <button id="toggleViewBtn" class="btn secondary" type="button">
              Alternar original/processada
            </button>
          </div>

          <p class="footer-note">
            Nota: Simulação educativa aproximada; não substitui avaliação
            profissional.
          </p>
        </div>
      </section>

      <!-- Coluna direita: conteúdo educativo -->
      <section class="stack" aria-label="Conteúdo educativo">
        <div class="card edu">
          <h2>ODS 3: Saúde e Bem-Estar</h2>
          <p>
            A ODS 3 busca garantir vidas saudáveis e promover o bem-estar para
            todos. Cuidar da visão faz parte desse objetivo, pois enxergar bem
            ajuda no aprendizado, segurança e qualidade de vida.
          </p>
          <ul>
            <li>Faça exames de vista regularmente e use óculos quando indicado.</li>
            <li>Proteja os olhos do sol com boné/óculos com proteção UV.</li>
            <li>Mantenha distância de telas e aplique a regra 20-20-20.</li>
            <li>Tenha alimentação equilibrada (vitaminas A, C, E ajudam).</li>
            <li>Procure orientação médica ao notar dificuldade visual.</li>
          </ul>
        </div>

        <div class="card group-card">
          <h2>6º ano B — Integrantes</h2>
          <ul>
            <li>Analu</li>
            <li>Bento</li>
            <li>Clarice</li>
            <li>Davi Emenes</li>
            <li>Davi Walter</li>
            <li>Gabriela</li>
            <li>Helena Felix</li>
            <li>João Pedro</li>
          </ul>
        </div>
      </section>
    </main>
  </div>

  <script>
    const $ = (s) => document.querySelector(s);

    const diseaseEl = $("#disease");
    const intensityEl = $("#intensity");
    const intensityLabel = $("#intensityLabel");
    const intensityTitle = $("#intensityTitle");
    const intensityHelp = $("#intensityHelp");
    const typeRow = $("#typeRow");
    const typeSelect = $("#typeSelect");
    const uploadEl = $("#upload");
    const baseImg = $("#baseImg");
    const canvas = $("#canvas");
    const stage = $("#stage");
    const resetBtn = $("#resetBtn");
    const toggleViewBtn = $("#toggleViewBtn");
    const downloadBtn = $("#downloadBtn");

    const ctx = canvas.getContext("2d");

    const state = {
      disease: "miopia",
      intensity: 40, // 0..100
      colorType: "deuteranopia",
      showProcessed: true,
      image: null,
    };

    function clamp(v, min, max) {
      return Math.max(min, Math.min(max, v));
    }

    function resizeCanvasToStage() {
      const rect = stage.getBoundingClientRect();
      if (rect.width < 2 || rect.height < 2) return;
      const dpr = Math.min(window.devicePixelRatio || 1, 2);
      canvas.style.width = rect.width + "px";
      canvas.style.height = rect.height + "px";
      canvas.width = Math.floor(rect.width);
      canvas.height = Math.floor(rect.height);
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    }

    function imageToCanvas(img) {
      const rect = stage.getBoundingClientRect();
      if (rect.width < 2 || rect.height < 2) return;
      const w = rect.width;
      const h = rect.height;
      const ratio = Math.max(w / img.naturalWidth, h / img.naturalHeight);
      const dw = img.naturalWidth * ratio;
      const dh = img.naturalHeight * ratio;
      const dx = (w - dw) / 2;
      const dy = (h - dh) / 2;
      ctx.clearRect(0, 0, w, h);
      ctx.drawImage(img, dx, dy, dw, dh);
    }

    function cataractEffect(imgData, strength) {
      const w = canvas.width;
      const h = canvas.height;
      const thePx = Math.round(2 + strength * 6);
      const off = document.createElement("canvas");
      off.width = w;
      off.height = h;
      const octx = off.getContext("2d");
      if ("filter" in octx) octx.filter = `blur(${thePx}px)`;
      octx.drawImage(canvas, 0, 0, w, h);
      let blurred;
      try {
        blurred = octx.getImageData(0, 0, w, h);
      } catch (e) {
        return imgData;
      }
      const d = blurred.data;
      const haze = 0.1 + strength * 0.35;
      const contrast = 1 - strength * 0.4;
      const mid = 128;
      for (let i = 0; i < d.length; i += 4) {
        d[i] = (d[i] + (255 - d[i]) * haze - mid) * contrast + mid;
        d[i + 1] = (d[i + 1] + (255 - d[i + 1]) * haze - mid) * contrast + mid;
        d[i + 2] = (d[i + 2] + (255 - d[i + 2]) * haze - mid) * contrast + mid;
      }
      return blurred;
    }

    function safeGetImageData(x, y, w, h) {
      try {
        return ctx.getImageData(x, y, w, h);
      } catch (e) {
        console.warn("getImageData failed (likely CORS/taint)", e);
        return null;
      }
    }

    function render() {
      resizeCanvasToStage();
      const rect = stage.getBoundingClientRect();
      if (rect.width < 2 || rect.height < 2) {
        requestAnimationFrame(render);
        return;
      }
      const img = state.image || baseImg;

      clearCanvasFilter();
      imageToCanvas(img);

      const w = canvas.width;
      const h = canvas.height;
      const strength = clamp(state.intensity / 100, 0, 1);

      if (state.disease === "miopia") {
        clearCanvasFilter();
        ctx.clearRect(0, 0, w, h);
        if ("filter" in ctx) {
          applyCanvasBlur(Math.round(strength * 10));
          imageToCanvas(img);
          clearCanvasFilter();
        } else {
          const data = safeGetImageData(0, 0, w, h);
          if (data) {
            ctx.drawImage(canvas, -1, -1, w + 2, h + 2);
          }
        }
      } else if (state.disease === "astigmatismo") {
        let imgData = safeGetImageData(0, 0, w, h);
        if (imgData) {
          imgData = astigmatismEffect(imgData, strength);
          ctx.putImageData(imgData, 0, 0);
        }
      } else if (state.disease === "daltonismo") {
        let imgData = safeGetImageData(0, 0, w, h);
        if (imgData) {
          imgData = applyColorMatrix(
            imgData,
            colorBlindMatrices[state.colorType],
            strength
          );
          ctx.putImageData(imgData, 0, 0);
        }
      } else if (state.disease === "catarata") {
        let imgData = safeGetImageData(0, 0, w, h);
        if (imgData) {
          ctx.putImageData(imgData, 0, 0);
          const processed = cataractEffect(imgData, strength);
          ctx.putImageData(processed, 0, 0);
        }
      }

      canvas.style.opacity = state.showProcessed ? "1" : "0";
      updateIntensityReadout();
    }

    downloadBtn.addEventListener("click", () => {
      canvas.toBlob((blob) => {
        if (!blob) return;
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `olho-de-aguia-${state.disease}.png`;
        a.target = "_blank";
        a.click();
        setTimeout(() => URL.revokeObjectURL(url), 1500);
      }, "image/png");
    });

    window.addEventListener("resize", render);
    baseImg.addEventListener("load", render);
    updateUIForDisease();
    render();
  </script>
</body>

</html>